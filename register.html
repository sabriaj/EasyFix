<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EasyFix - Regjistro dhe Abono</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 flex flex-col items-center min-h-screen">

  <h1 class="text-3xl font-bold mb-6">Regjistro Firmën dhe Zgjidh Planin</h1>

  <form id="firmForm" class="bg-white p-6 rounded shadow-md w-full max-w-md">
    <input id="emri" type="text" placeholder="Emri i firmës" required class="w-full mb-3 p-2 border rounded" />
    <input id="adresa" type="text" placeholder="Adresa / Qyteti" required class="w-full mb-3 p-2 border rounded" />
    <input id="telefoni" type="tel" placeholder="Numër telefoni" required class="w-full mb-3 p-2 border rounded" />
    <input id="email" type="email" placeholder="Email" required class="w-full mb-3 p-2 border rounded" />
    <input id="kategoria" type="text" placeholder="Kategoria (p.sh. Elektricist)" required class="w-full mb-3 p-2 border rounded" />

    <p class="mb-3 font-semibold">Zgjidh planin e abonimit:</p>
    <div class="flex space-x-4 mb-4">
      <button type="button" data-plan="mujor" data-url="https://buy.stripe.com/test_6oUaEP63Q2Ci1ak0bn0Ba00" class="planBtn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
        Plan Mujor $20
      </button>
      <button type="button" data-plan="vjetor" data-url="https://buy.stripe.com/test_5kQ28j4ZM3Gm7yI2jv0Ba01" class="planBtn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
        Plan Vjetor $200
      </button>
    </div>

    <input type="hidden" id="selectedPlan" />
    <input type="hidden" id="selectedUrl" />

    <button type="submit" class="bg-blue-600 text-white py-2 rounded w-full hover:bg-blue-700 transition">Regjistrohu</button>

    <p id="status" class="mt-4 text-center font-semibold"></p>
  </form>

  <script>
    const planButtons = document.querySelectorAll('.planBtn');
    const selectedPlanInput = document.getElementById('selectedPlan');
    const selectedUrlInput = document.getElementById('selectedUrl');
    const status = document.getElementById('status');

    planButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Hiq stilin aktiv nga të tjerët
        planButtons.forEach(b => b.classList.remove('ring', 'ring-offset-2'));
        // Shto stilin aktiv
        btn.classList.add('ring', 'ring-offset-2');
        selectedPlanInput.value = btn.dataset.plan;
        selectedUrlInput.value = btn.dataset.url;
      });
    });

    document.getElementById('firmForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const emri = document.getElementById('emri').value.trim();
      const adresa = document.getElementById('adresa').value.trim();
      const telefoni = document.getElementById('telefoni').value.trim();
      const email = document.getElementById('email').value.trim();
      const kategoria = document.getElementById('kategoria').value.trim();
      const plan = selectedPlanInput.value;
      const url = selectedUrlInput.value;

      if (!plan) {
        status.textContent = "Zgjidh planin para regjistrimit!";
        status.style.color = 'red';
        return;
      }

      status.textContent = "Duke regjistruar firmën...";
      status.style.color = 'black';

      const data = { emri, adresa, telefoni, email, kategoria, plan };

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycby6QDKssZAMwrOKxhqOVCP29r2-dBBBXx8r4tL4BtzSTOELFUVtRtCwOp8opFpb7eepcg/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          status.textContent = "Regjistrimi u krye me sukses!";
          status.style.color = 'green';
          setTimeout(() => {
            window.location.href = url;
          }, 1000);
        } else {
          throw new Error("Dështoi regjistrimi");
        }
      } catch (err) {
        console.error(err);
        status.textContent = "Gabim gjatë regjistrimit, provo përsëri.";
        status.style.color = 'red';
      }
    });
  </script>

</body>
</html>
