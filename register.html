<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EasyFix - Regjistro dhe Abono</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .wrap {
      width: 100%;
      max-width: 450px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      padding: 28px;
      margin: 20px auto;
    }
    
    h1 {
      font-size: 24px;
      margin: 0 0 20px;
      text-align: center;
      color: #1e293b;
      font-weight: 600;
    }
    
    .input-group {
      margin-bottom: 15px;
    }
    
    .in {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s;
    }
    
    .in:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }
    
    .plans {
      display: flex;
      gap: 12px;
      margin: 15px 0 10px;
    }
    
    .plan-btn {
      flex: 1;
      padding: 14px;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
      background: #f9fafb;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .plan-btn:hover {
      background: #e5e7eb;
    }
    
    .plan-btn.active {
      background: #1d4ed8;
      color: #fff;
      border-color: #1d4ed8;
    }
    
    .hint {
      font-size: 14px;
      color: #4b5563;
      margin: 10px 0 5px;
    }
    
    .submit {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 10px;
      background: #16a34a;
      color: #fff;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.3s;
    }
    
    .submit:hover {
      background: #15803d;
    }
    
    .submit:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    
    .status {
      margin-top: 15px;
      text-align: center;
      font-weight: 500;
      min-height: 24px;
      padding: 8px;
      border-radius: 6px;
    }
    
    .error {
      color: #dc2626;
      background: #fef2f2;
    }
    
    .success {
      color: #166534;
      background: #f0fdf4;
    }
    
    .loading {
      color: #1e40af;
      background: #eff6ff;
    }
    
    .debug {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    
    .debug-toggle {
      color: #3b82f6;
      cursor: pointer;
      font-size: 13px;
      margin-top: 10px;
      text-align: center;
    }
    
    @media (max-width: 480px) {
      .wrap {
        padding: 20px;
      }
      
      .plans {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Regjistro Firm√´n & Zgjidh Planin</h1>

    <form id="registerForm" novalidate>
      <div class="input-group">
        <input class="in" type="text" name="emri" placeholder="Emri i firm√´s" required />
      </div>
      
      <div class="input-group">
        <input class="in" type="text" name="adresa" placeholder="Adresa / Qyteti" required />
      </div>
      
      <div class="input-group">
        <input class="in" type="tel" name="telefoni" placeholder="Num√´r telefoni" required />
      </div>
      
      <div class="input-group">
        <input class="in" type="email" name="email" placeholder="Email" required />
      </div>
      
      <div class="input-group">
        <input class="in" type="text" name="kategoria" placeholder="Kategoria (p.sh. Elektricist)" required />
      </div>

      <div class="hint">Zgjidh planin e abonimit (e detyrueshme):</div>
      
      <div class="plans">
        <button type="button" class="plan-btn" data-plan="1 Muaj">Mujor $10</button>
        <button type="button" class="plan-btn" data-plan="1 Vit">Vjetor $100</button>
      </div>

      <input type="hidden" id="plan" name="plan" />
      <button id="submitBtn" class="submit" type="submit">Regjistrohu</button>
      
      <div id="status" class="status"></div>
    </form>
    
    <div class="debug-toggle" onclick="toggleDebug()">üîç Shfaq informacione diagnostikuese</div>
    <div id="debugInfo" class="debug"></div>
  </div>

  <script>
    // ‚õî Z√´vend√´so me URL-n t√´nde t√´ Apps Script (deployment "Web app")
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWxyJntUVRpnxNapWI9njTAGvq_A3B3rm1f5eZYCevrNT8xdkGUYOC7iTkKNaMg82ibA/exec";

    const form = document.getElementById('registerForm');
    const statusEl = document.getElementById('status');
    const planInput = document.getElementById('plan');
    const planButtons = document.querySelectorAll('.plan-btn');
    const submitBtn = document.getElementById('submitBtn');
    const debugInfo = document.getElementById('debugInfo');

    // Funksioni p√´r t√´ shfaqur/fshehur informacionet diagnostikuese
    function toggleDebug() {
      debugInfo.style.display = debugInfo.style.display === 'block' ? 'none' : 'block';
    }

    // Funksioni p√´r t√´ shfaqur statusin
    function showStatus(message, type) {
      statusEl.textContent = message;
      statusEl.className = 'status';
      
      if (type === 'error') {
        statusEl.classList.add('error');
      } else if (type === 'success') {
        statusEl.classList.add('success');
      } else if (type === 'loading') {
        statusEl.classList.add('loading');
      }
    }

    // Funksioni p√´r t√´ shfaqur informacione diagnostikuese
    function logDebugInfo(info) {
      debugInfo.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${info}</div>`;
    }

    // Inicializimi i butonave t√´ planit
    planButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        planButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        planInput.value = btn.dataset.plan;
        
        // Aktivizo butonin e submit
        submitBtn.disabled = false;
        logDebugInfo(`Plan i zgjedhur: ${btn.dataset.plan}`);
      });
    });

    // Validimi i form√´s
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!planInput.value) {
        showStatus("Ju lutem zgjidhni nj√´ plan abonimi!", "error");
        logDebugInfo("Gabim: Nuk √´sht√´ zgjedhur asnj√´ plan");
        return;
      }

      // Validimi i t√´ dh√´nave
      const inputs = form.querySelectorAll('input[required]');
      let isValid = true;
      
      inputs.forEach(input => {
        if (!input.value.trim()) {
          input.style.borderColor = '#dc2626';
          isValid = false;
        } else {
          input.style.borderColor = '#d1d5db';
        }
      });
      
      if (!isValid) {
        showStatus("Ju lutem plot√´soni t√´ gjitha fushat!", "error");
        logDebugInfo("Gabim: Jan√´ l√´n√´ bosh disa fusha t√´ detyrueshme");
        return;
      }

      const data = {
        emri: form.emri.value.trim(),
        adresa: form.adresa.value.trim(),
        telefoni: form.telefoni.value.trim(),
        email: form.email.value.trim(),
        kategoria: form.kategoria.value.trim(),
        plan: planInput.value
      };

      logDebugInfo(`Duke d√´rguar t√´ dh√´nat: ${JSON.stringify(data)}`);
      logDebugInfo(`URL e scriptit: ${SCRIPT_URL}`);

      // D√´rgo t√´ dh√´nat
      showStatus("Duke regjistruar...", "loading");
      submitBtn.disabled = true;

      try {
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { 
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        });
        
        logDebugInfo(`P√´rgjigja e serverit: Status ${response.status}`);
        
        // Kontrollo n√´se p√´rgjigja √´sht√´ e suksesshme
        if (!response.ok) {
          throw new Error(`Gabim n√´ server: ${response.status} ${response.statusText}`);
        }
        
        const result = await response.json();
        logDebugInfo(`P√´rgjigja e serverit: ${JSON.stringify(result)}`);
        
        if (result.status === 'success' && result.url) {
          showStatus("U regjistrua! Po hapet pagesa‚Ä¶", "success");
          logDebugInfo("U krye me sukses, duke ridrejtuar p√´r pages√´...");
          
          // Ridrejto te PayPal pas 1.5 sekondash
          setTimeout(() => {
            window.location.href = result.url;
          }, 1500);
        } else {
          throw new Error(result.message || 'Gabim gjat√´ regjistrimit');
        }
      } catch (err) {
        console.error(err);
        logDebugInfo(`Gabim: ${err.message}`);
        showStatus("Gabim gjat√´ regjistrimit. Provo p√´rs√´ri.", "error");
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
