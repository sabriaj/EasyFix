<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EasyFix - Regjistro dhe Abono</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 flex flex-col items-center min-h-screen">

  <h1 class="text-3xl font-bold mb-6">Regjistro Firmën dhe Zgjidh Planin</h1>

  <form id="firmForm" class="bg-white p-6 rounded shadow-md w-full max-w-md">
    <input type="text" name="emri" id="emri" placeholder="Emri i firmës" required class="w-full mb-3 p-2 border rounded" />
    <input type="text" name="adresa" id="adresa" placeholder="Adresa / Qyteti" required class="w-full mb-3 p-2 border rounded" />
    <input type="tel" name="telefoni" id="telefoni" placeholder="Numër telefoni" required class="w-full mb-3 p-2 border rounded" />
    <input type="email" name="email" id="email" placeholder="Email" required class="w-full mb-3 p-2 border rounded" />
    <input type="text" name="kategoria" id="kategoria" placeholder="Kategoria (p.sh. Elektricist)" required class="w-full mb-3 p-2 border rounded" />

    <p class="mb-3 font-semibold">Zgjidh planin e abonimit:</p>
    <div class="mb-4 space-y-2">
      <label class="flex items-center space-x-2">
        <input 
          type="radio" 
          name="plan" 
          value="mujor" 
          class="planRadio accent-green-500" 
          data-url="https://buy.stripe.com/test_6oUaEP63Q2Ci1ak0bn0Ba00" />
        <span>Plan Mujor $20</span>
      </label>
      <label class="flex items-center space-x-2">
        <input 
          type="radio" 
          name="plan" 
          value="vjetor" 
          class="planRadio accent-blue-500" 
          data-url="https://buy.stripe.com/test_5kQ28j4ZM3Gm7yI2jv0Ba01" />
        <span>Plan Vjetor $200</span>
      </label>
    </div>

    <button type="submit" id="submitBtn" class="bg-blue-600 text-white py-2 rounded w-full hover:bg-blue-700 transition">Regjistrohu</button>

    <p id="status" class="mt-4 text-center font-semibold"></p>
  </form>

  <script>
    const firmForm = document.getElementById('firmForm');
    const status = document.getElementById('status');

    firmForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const selectedRadio = document.querySelector('input[name="plan"]:checked');
      if (!selectedRadio) {
        status.textContent = "Ju lutem zgjidhni një plan abonimi!";
        status.style.color = 'red';
        return;
      }

      status.textContent = "Duke regjistruar firmën...";
      status.style.color = 'black';

      const data = {
        emri: document.getElementById("emri").value.trim(),
        adresa: document.getElementById("adresa").value.trim(),
        telefoni: document.getElementById("telefoni").value.trim(),
        email: document.getElementById("email").value.trim(),
        kategoria: document.getElementById("kategoria").value.trim(),
        plan: selectedRadio.value
      };

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycby6QDKssZAMwrOKxhqOVCP29r2-dBBBXx8r4tL4BtzSTOELFUVtRtCwOp8opFpb7eepcg/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.status === "sukses") {
          status.textContent = "Firma u regjistrua me sukses! Po të dërgojmë për pagesë...";
          status.style.color = 'green';
          setTimeout(() => {
            window.location.href = selectedRadio.dataset.url;
          }, 1500);
        } else {
          throw new Error("Gabim gjatë regjistrimit.");
        }

      } catch (err) {
        status.textContent = "Gabim gjatë regjistrimit, provo përsëri.";
        status.style.color = 'red';
        console.error(err);
      }
    });
  </script>

</body>
</html>

